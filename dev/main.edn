{:http {:port 1312
        :handler #ig/ref :bread/handler
        :wrap-defaults #ig/ref :ring/wrap-defaults}
 :ring/wrap-defaults {:kind :site-defaults
                      :session-store #ig/ref :ring/session-store
                      :overrides {[:security :anti-forgery] false
                                  [:session :cookie-name] "bread-session"
                                  ;; https://github.com/ring-clojure/ring/blob/fd08dd8d905bc8062866cfec938c8cbf65afc7b0/ring-core/src/ring/middleware/cookies.clj#L101
                                  [:session :cookie-attrs] {:http-only true
                                                            :secure true
                                                            :max-age 259200 ;; 72h
                                                            :path "/"
                                                            :same-site :strict}}}
 :ring/session-store
 {:store/type :datalog
  :store/db #ig/ref :bread/db
  :max-age 259200}
 :bread/handler #ig/ref :bread/app
 :bread/app
 {:site {:name "Breadbox"}
  :db #ig/ref :bread/db
  :auth {:protected-prefixes ["/~/"]
         :login-uri "/~/login"
         ;:require-mfa? true
         :min-password-length 4
         :store-session-ip? true
         :store-session-user-agent? true}
  :signup {:invite-only? true}
  :account {:account-uri "/~/account"}
  :i18n {:home-route :home
         :query-global-strings? false
         :supported-langs #{:en :fr :es :ar}
         :fallback-lang :ar}
  :routes {:router #ig/ref :bread/router}
  :components {:not-found #var systems.bread.alpha.cms.theme/NotFoundPage}
  :navigation {:menus {:main-nav
                       {:menu/type :systems.bread.alpha.navigation/location
                        :menu/location :primary
                        :route/name :page}}}
  :marx {:site-name "Breadbox"}
  :email {:dry-run? true
          :smtp-from-email #env SMTP_FROM_EMAIL
          :smtp-host #env SMTP_HOST
          :smtp-port #env SMTP_PORT
          :smtp-username #env SMTP_USERNAME
          :smtp-password #env SMTP_PASSWORD
          :smtp-tls? #env SMTP_USE_TLS}
  :plugins []} ;; define additional plugins here
 :bread/db
 {:db/type :datahike
  :db/recreate? true
  :db/config {:schema-flexibility :write
              :keep-history? true
              ;; Set one of the following:
              ;; STORE_BACKEND=jdbc
              ;; STORE_BACKEND=mem
              :store #include #join ["db-store." #or [#env STORE_BACKEND "jdbc"] ".edn"]}
  :db/initial-txns
  [{:invitation/code "a7d190e5-d7f4-4b92-a751-3c36add92610"
    :invitation/invited-by "user.admin"}
   {:db/id "user.admin"
    :user/username "bread"
    :user/name "Bread User"
    :user/emails [{:email/address "admin@bread.systems"
                   :email/code "already_confirmed"
                   :email/confirmed-at #inst "2025-03-06T04:40:00-08:00"
                   :email/primary? true}
                  {:email/address "admin2@bread.systems"
                   :email/confirmed-at #inst "2025-12-30T12:00:00-08:00"
                   :email/code "qwerty"}
                  {:thing/created-at #seconds-ago 0
                   :email/address "admin3@bread.systems"
                   :email/code "asdf"}]
    :user/password #buddy/derive ["hello"]
    #_#_ ;; Uncomment to enable MFA
    :user/totp-key "B67CWTTTP7UQ5KWT"
    :user/failed-login-count 0
    :user/preferences "{}"
    :user/lang :en
    :user/roles
    #{{:role/key :author
       :role/abilities
       #{{:ability/key :publish-posts}
         {:ability/key :edit-posts}
         {:ability/key :delete-posts}}}}}
   {:user/username "reader"
    :user/name "Reader User"
    ;; No emails yet!
    :user/password #buddy/derive ["hello"]
    :user/failed-login-count 0
    :user/preferences "{}"
    :user/lang :en}
   ,]
  ;; db logs can be noisy, so load logging config first
  :__after #ig/ref :app/log}
 :app/log
 {:min-level [[#{"systems.bread.*"} :debug]
              [#{"datahike.*"} :info]
              [#{"*"} :warn]]}
 :bread/profilers
 [{:profiler/type :hook
   :hook #{:systems.bread.alpha.core/dispatch
           :systems.bread.alpha.core/expand
           :systems.bread.alpha.core/effects!}
   :!action/name #{:systems.bread.alpha.defaults/config
                   :systems.bread.alpha.expansion/expand
                   :systems.bread.alpha.component/hook-fn}
   :f #var systems.bread.alpha.tools.util/log-lifecycle-hook}
  {:profiler/type :expansion
   :expansion #{:systems.bread.alpha.database/query}
   :f #var systems.bread.alpha.tools.util/log-query}]
 #_#_
 :bread/debugger
 {:http
  {:port 1313
   :docroot "public/debugger"
   :middleware [#var systems.bread.alpha.cms.main/wrap-debug]}}}
